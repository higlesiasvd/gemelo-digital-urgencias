# Diagramas de Arquitectura

Este documento contiene diagramas adicionales para el informe y presentación.

## Diagrama de Componentes (UML)

```
┌────────────────────────────────────────────────────────────────────────────────┐
│                              SISTEMA COMPLETO                                   │
├────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                           <<subsystem>>                                  │   │
│  │                              FRONTEND                                    │   │
│  │  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ │   │
│  │  │  App.tsx  │ │ Dashboard │ │   Staff   │ │ Predictor │ │  Chatbot  │ │   │
│  │  │  (entry)  │ │   Page    │ │   Page    │ │   Page    │ │  Widget   │ │   │
│  │  └─────┬─────┘ └─────┬─────┘ └─────┬─────┘ └─────┬─────┘ └─────┬─────┘ │   │
│  │        │             │             │             │             │       │   │
│  │        └──────┬──────┴──────┬──────┴──────┬──────┴──────┬──────┘       │   │
│  │               │             │             │             │              │   │
│  │  ┌────────────┴─────────────┴─────────────┴─────────────┴───────────┐  │   │
│  │  │                      <<component>>                                │  │   │
│  │  │                    ZustandStore + Hooks                           │  │   │
│  │  │  useHospitals() | useWebSocket() | useContexto() | useQuery()    │  │   │
│  │  └──────────────────────────────┬───────────────────────────────────┘  │   │
│  └─────────────────────────────────┼──────────────────────────────────────┘   │
│                                    │ WebSocket + REST                          │
│  ┌─────────────────────────────────┼──────────────────────────────────────┐   │
│  │                           <<subsystem>>                                 │   │
│  │                              BACKEND                                    │   │
│  │                                                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │  <<component>> │  <<component>> │  <<component>> │  <<component>> │   │   │
│  │  │   API REST  │  │   Chatbot   │  │   Prophet   │  │ Coordinator │   │   │
│  │  │   FastAPI   │  │  MCP+Groq   │  │   Service   │  │ Derivaciones│   │   │
│  │  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘   │   │
│  │         │                │                │                │          │   │
│  │         └────────┬───────┴────────┬───────┴────────┬───────┘          │   │
│  │                  │                │                │                   │   │
│  │  ┌───────────────┴────────────────┴────────────────┴────────────────┐ │   │
│  │  │                      <<component>>                                │ │   │
│  │  │                      Kafka Client                                 │ │   │
│  │  │              produce() | consume() | subscribe()                  │ │   │
│  │  └───────────────────────────────┬──────────────────────────────────┘ │   │
│  └──────────────────────────────────┼────────────────────────────────────┘   │
│                                     │                                         │
│  ┌──────────────────────────────────┼────────────────────────────────────┐   │
│  │                           <<subsystem>>                                │   │
│  │                        MESSAGE BROKER                                  │   │
│  │  ┌───────────────────────────────────────────────────────────────────┐│   │
│  │  │                    Apache Kafka (12 topics)                       ││   │
│  │  │ patient-arrivals | triage-results | hospital-stats | ...         ││   │
│  │  └───────────────────────────────┬───────────────────────────────────┘│   │
│  └──────────────────────────────────┼────────────────────────────────────┘   │
│                                     │                                         │
│  ┌──────────────────────────────────┼────────────────────────────────────┐   │
│  │                           <<subsystem>>                                │   │
│  │                            SIMULATOR                                   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │   │
│  │  │  <<component>> │  <<component>> │  <<component>> │  <<component>> │   │   │
│  │  │HospitalSim  │  │ FlowEngine  │  │PatientGen   │  │DemandFactors│   │   │
│  │  │  (SimPy)    │  │  (SimPy)    │  │             │  │ APIs Externas│  │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │   │
│  └───────────────────────────────────────────────────────────────────────┘   │
│                                                                               │
│  ┌───────────────────────────────────────────────────────────────────────┐   │
│  │                           <<subsystem>>                                │   │
│  │                           PERSISTENCE                                  │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │   │
│  │  │ PostgreSQL  │  │  InfluxDB   │  │   Grafana   │                    │   │
│  │  │   (Staff)   │  │  (Metrics)  │  │ (Dashboards)│                    │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                    │   │
│  └───────────────────────────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────────────────────────────┘
```

## Diagrama de Secuencia: Flujo de Paciente

```
┌─────────┐  ┌──────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐
│Generator│  │FlowEngine│  │  Kafka  │  │   MCP   │  │WebSocket│  │Frontend │
└────┬────┘  └────┬─────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘
     │            │             │            │            │            │
     │ create()   │             │            │            │            │
     ├───────────>│             │            │            │            │
     │            │             │            │            │            │
     │            │ process()   │            │            │            │
     │            ├─────────────┤            │            │            │
     │            │ ventanilla  │            │            │            │
     │            │ (2 min)     │            │            │            │
     │            ├─────────────┤            │            │            │
     │            │             │            │            │            │
     │            │ triaje      │            │            │            │
     │            │ (5 min)     │            │            │            │
     │            ├─────────────┤            │            │            │
     │            │             │            │            │            │
     │            │ publish     │            │            │            │
     │            │ triage-     │            │            │            │
     │            │ results     │            │            │            │
     │            ├────────────>│            │            │            │
     │            │             │            │            │            │
     │            │             │ consume()  │            │            │
     │            │             ├───────────>│            │            │
     │            │             │            │            │            │
     │            │             │            │ update     │            │
     │            │             │            │ state      │            │
     │            │             │            ├───────────>│            │
     │            │             │            │            │            │
     │            │             │            │            │ push       │
     │            │             │            │            │ status     │
     │            │             │            │            ├───────────>│
     │            │             │            │            │            │
     │            │ consulta    │            │            │            │
     │            │ (15 min)    │            │            │            │
     │            ├─────────────┤            │            │            │
     │            │             │            │            │            │
     │            │ publish     │            │            │            │
     │            │ consultation│            │            │            │
     │            │ -events     │            │            │            │
     │            ├────────────>│            │            │            │
     │            │             │─ ─ ─ ─ ─ ─>│─ ─ ─ ─ ─ ─>│─ ─ ─ ─ ─ ─>│
     │            │             │            │            │            │
     │            │ complete()  │            │            │            │
     │            ├─────────────┤            │            │            │
     │            │             │            │            │            │
┌────┴────┐  ┌────┴─────┐  ┌────┴────┐  ┌────┴────┐  ┌────┴────┐  ┌────┴────┐
│Generator│  │FlowEngine│  │  Kafka  │  │   MCP   │  │WebSocket│  │Frontend │
└─────────┘  └──────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘
```

## Diagrama de Estados: Paciente

```
                                    ┌─────────────┐
                                    │   INICIO    │
                                    │  (llegada)  │
                                    └──────┬──────┘
                                           │
                                           ▼
                              ┌─────────────────────────┐
                              │    EN_COLA_VENTANILLA   │
                              │    (esperando celador)  │
                              └────────────┬────────────┘
                                           │ recurso disponible
                                           ▼
                              ┌─────────────────────────┐
                              │     EN_VENTANILLA       │
                              │    (registro ~2min)     │
                              └────────────┬────────────┘
                                           │
                                           ▼
                              ┌─────────────────────────┐
                              │    EN_COLA_TRIAJE       │
                              │  (esperando enfermera)  │
                              └────────────┬────────────┘
                                           │ recurso disponible
                                           ▼
                              ┌─────────────────────────┐
                              │       EN_TRIAJE         │
                              │   (evaluación ~5min)    │
                              └────────────┬────────────┘
                                           │
                    ┌──────────────────────┼──────────────────────┐
                    │                      │                      │
                    ▼                      ▼                      ▼
        ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐
        │  ROJO/NARANJA     │  │     AMARILLO      │  │   VERDE/AZUL      │
        │  (hospital peq.)  │  │                   │  │                   │
        └─────────┬─────────┘  └─────────┬─────────┘  └─────────┬─────────┘
                  │                      │                      │
                  ▼                      │                      │
        ┌───────────────────┐            │                      │
        │    DERIVACIÓN     │            │                      │
        │    (a CHUAC)      │            │                      │
        └─────────┬─────────┘            │                      │
                  │                      │                      │
                  └──────────────────────┼──────────────────────┘
                                         │
                                         ▼
                              ┌─────────────────────────┐
                              │   EN_COLA_CONSULTA      │
                              │  (prioridad por nivel)  │
                              └────────────┬────────────┘
                                           │ recurso disponible
                                           ▼
                              ┌─────────────────────────┐
                              │      EN_CONSULTA        │
                              │    (atención médica)    │
                              │     5-30 min            │
                              └────────────┬────────────┘
                                           │
                         ┌─────────────────┼─────────────────┐
                         │                 │                 │
                         ▼                 │                 ▼
              ┌───────────────────┐        │      ┌───────────────────┐
              │       ALTA        │        │      │   OBSERVACIÓN     │
              │      (85%)        │        │      │      (15%)        │
              └───────────────────┘        │      └───────────────────┘
                                           │
                                           ▼
                              ┌─────────────────────────┐
                              │         FIN             │
                              └─────────────────────────┘
```

## Diagrama de Despliegue (Docker)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           <<deployment>>                                     │
│                        Docker Compose Host                                   │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                     urgencias-network (bridge)                         │  │
│  │                                                                        │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │  │
│  │  │  frontend   │  │     api     │  │   chatbot   │  │   prophet   │   │  │
│  │  │ nginx:alpine│  │   python    │  │   python    │  │   python    │   │  │
│  │  │  :3003      │  │   :8000     │  │   :8080     │  │   :8001     │   │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘   │  │
│  │                                                                        │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │  │
│  │  │  simulator  │  │ coordinator │  │   nodered   │                    │  │
│  │  │   python    │  │   python    │  │   nodered   │                    │  │
│  │  │   (SimPy)   │  │             │  │   :1880     │                    │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                    │  │
│  │                         │                                              │  │
│  │  ┌─────────────────────┴─────────────────────┐                        │  │
│  │  │                                            │                        │  │
│  │  │  ┌─────────────┐  ┌─────────────┐         │                        │  │
│  │  │  │  zookeeper  │  │    kafka    │         │                        │  │
│  │  │  │  :2181      │  │   :9092     │         │                        │  │
│  │  │  └─────────────┘  └─────────────┘         │                        │  │
│  │  │                                            │                        │  │
│  │  │  ┌─────────────┐                          │                        │  │
│  │  │  │  kafka-ui   │                          │                        │  │
│  │  │  │   :8085     │                          │                        │  │
│  │  │  └─────────────┘                          │                        │  │
│  │  └────────────────────────────────────────────┘                        │  │
│  │                                                                        │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │  │
│  │  │  postgres   │  │  influxdb   │  │   grafana   │                    │  │
│  │  │   :5433     │  │   :8086     │  │   :3001     │                    │  │
│  │  │  (volume)   │  │  (volume)   │  │  (volume)   │                    │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                    │  │
│  │                                                                        │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

Leyenda:
  :XXXX = Puerto expuesto
  (volume) = Volumen persistente
```

## Flujo de Datos Completo

```
┌───────────────────────────────────────────────────────────────────────────────┐
│                         FLUJO DE DATOS END-TO-END                             │
└───────────────────────────────────────────────────────────────────────────────┘

GENERACIÓN                PROCESAMIENTO              ALMACENAMIENTO    VISUALIZACIÓN
─────────────────────────────────────────────────────────────────────────────────

┌──────────────┐
│ Open-Meteo   │ ──(clima)──┐
│   API        │            │
└──────────────┘            │
                            ▼
┌──────────────┐      ┌──────────────┐
│ TheSportsDB  │──────│DemandFactors │─────┐
│   API        │      │  (Python)    │     │
└──────────────┘      └──────────────┘     │
                                           │
                                           ▼
                      ┌──────────────┐ ────────┐
                      │PatientGenerator      │
                      │  (Python)    │      │
                      └──────────────┘      │
                            │               │
                            ▼               │
                      ┌──────────────┐      │
                      │ FlowEngine   │      │
                      │   (SimPy)    │      │
                      └──────┬───────┘      │
                             │              │
        ┌────────────────────┼──────────────┘
        │                    │
        ▼                    ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  Kafka       │      │  Node-RED    │ ─────│  InfluxDB    │
│  Topics      │ ─────│ (transform)  │      │  (metrics)   │
│  (12)        │      └──────────────┘      └──────┬───────┘
└──────┬───────┘                                   │
       │                                           │
       ▼                                           ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  MCP Server  │      │  PostgreSQL  │      │   Grafana    │
│  (aggregate) │      │  (staff)     │      │ (dashboards) │
└──────┬───────┘      └──────────────┘      └──────────────┘
       │                     ▲
       │                     │
       ▼                     │
┌──────────────┐      ┌──────────────┐
│  WebSocket   │      │   API REST   │
│  (push)      │      │  (request)   │
└──────┬───────┘      └──────┬───────┘
       │                     │
       └──────────┬──────────┘
                  │
                  ▼
            ┌──────────────┐
            │   Frontend   │
            │  (React UI)  │
            └──────────────┘
```
